---
output: html_document
---
NC Campaign Contributions for 2012 Presidential Election by Steven Yeh
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

# setwd('/Users/Stevenstuff/Documents/Udacity/Project4/P4')

library(ggplot2)
library(dplyr)
library(tidyr)
library(reshape2)
library(GGally)
library(splines)
library(gridExtra)
library(MASS)
library(car)
library(lattice)
library(scales)
library(memisc)
library(modeest)
library(ca)
library(vcd)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
nc <- read.csv('nc1.csv', header = T, sep = ',', row.names = NULL)
```

# Data Processing/Transformations

``` {r echo=TRUE, tidy = TRUE}

# adding new column: party ------------------------------
nc$party <- ifelse(nc$cand_nm == 'Stein, Jill', 'Green',                ifelse(nc$cand_nm == 'Johnson, Gary                      Earl', 'Libertarian',                                       ifelse(nc$cand_nm == 'Obama,                             Barack', 'Democratic', 'Republican')))

nc$party <- as.factor(nc$party)

# fixing dates ------------------------------------------
nc$contb_receipt_dt <- as.Date(nc$contb_receipt_dt,
                               '%d-%b-%y')

# fixing zip codes and adding three digit zip column ----
nc$contbr_zip = substr(nc$contbr_zip, 1, 5)
nc$contbr_zip <- as.factor(nc$contbr_zip)
nc$threedigit_zip <- substr(nc$contbr_zip, 1, 3)

# fixing city names -------------------------------------
options(max.print = 500000)
nc$contbr_city <- gsub('^WINSTON.*SALEM$', 'WINSTON-SALEM', nc$contbr_city)
nc$contbr_city <- gsub('APE', 'APEX', nc$contbr_city)
nc$contbr_city <- gsub('APEXX$', 'APEX', nc$contbr_city)
nc$contbr_city <- gsub('^A.*VILLE.*', 'ASHEVILLE', nc$contbr_city)
nc$contbr_city <- gsub('ASHEVILE', 'ASHEVILLE', nc$contbr_city)
nc$contbr_city <- gsub('ASHEVILLLE', 'ASHEVILLE', nc$contbr_city)
nc$contbr_city <- gsub('^ATLANTIC B.*', 'ATLANTIC BEACH', nc$contbr_city)
nc$contbr_city <- gsub('AUROR', 'AURORA', nc$contbr_city)
nc$contbr_city <- gsub('B ELMONT', 'BELMONT', nc$contbr_city)
nc$contbr_city <- gsub('BALD HEAD ISL', 'BALD HEAD ISLAND', nc$contbr_city)
nc$contbr_city <- gsub('^BLACK M.*', 'BLACK MOUNTAIN', nc$contbr_city)
nc$contbr_city <- gsub('BOONE, NC', 'BOONE', nc$contbr_city)
nc$contbr_city <- gsub('BROWN SUMMIT', 'BROWNS SUMMIT', nc$contbr_city)
nc$contbr_city <- gsub('CHAR.*OT.*', 'CHARLOTTE', nc$contbr_city)
nc$contbr_city <- gsub('CHAROLETTE', 'CHARLOTTE', nc$contbr_city)
nc$contbr_city <- gsub('CHA.*LOTTE', 'CHARLOTTE', nc$contbr_city)
nc$contbr_city <- gsub('^CHAP.*ILL.*', 'CHAPEL HILL', nc$contbr_city)
nc$contbr_city <- gsub('CH.*HILL', 'CHAPEL HILL', nc$contbr_city)
nc$contbr_city <- gsub('CHAPEL', 'CHAPEL HILL', nc$contbr_city)
nc$contbr_city <- gsub('CAPEL HILL', 'CHAPEL HILL', nc$contbr_city)
nc$contbr_city <- gsub('^CHAPEL HILL HILL$', 'CHAPEL HILL', nc$contbr_city)
nc$contbr_city <- gsub('CAROLINA B.*', 'CAROLINA BEACH', nc$contbr_city)
nc$contbr_city <- gsub('CARR.*', 'CARRBORO', nc$contbr_city)
nc$contbr_city <- gsub('CARY,', 'CARY', nc$contbr_city)
nc$contbr_city <- gsub('CEDAR M.*', 'CEDAR MOUNTAIN', nc$contbr_city)
nc$contbr_city <- gsub('CLEMMONS,', 'CLEMMONS', nc$contbr_city)
nc$contbr_city <- gsub('CONNELLY.*', 'CONNELLY SPRINGS', nc$contbr_city)
nc$contbr_city <- gsub('CORNELUS', 'CORNELIUS', nc$contbr_city)
nc$contbr_city <- gsub('DU.*HAM.*', 'DURHAM', nc$contbr_city)
nc$contbr_city <- gsub('DYRHAM', 'DURHAM', nc$contbr_city)
nc$contbr_city <- gsub('E FLAT ROCK', 'EAST FLAT ROCK', nc$contbr_city)
nc$contbr_city <- gsub('EDENTON-', 'EDENTON', nc$contbr_city)
nc$contbr_city <- gsub('ELIZABETH CTY', 'ELIZABETH CITY', nc$contbr_city)
nc$contbr_city <- gsub('^FORT\\+BRAGG$', 'FORT BRAGG', nc$contbr_city)
nc$contbr_city <- gsub('.*QUAY.*VARINA', 'FUQUAY-VARINA', nc$contbr_city)
nc$contbr_city <- gsub('GASTONIA.*', 'GASTONIA', nc$contbr_city)
nc$contbr_city <- gsub('GRE.*RO.*', 'GREENSBORO', nc$contbr_city)
nc$contbr_city <- gsub('GREENVILLLE', 'GREENVILLE', nc$contbr_city)
nc$contbr_city <- gsub('HENDERSONV.*', 'HENDERSONVILLE', nc$contbr_city)
nc$contbr_city <- gsub('HGILLSBOOROUGH', 'HILLSBOROUGH', nc$contbr_city)
nc$contbr_city <- gsub('HICKORY.*', 'HICKORY', nc$contbr_city)
nc$contbr_city <- gsub('HIGH P.*', 'HIGH POINT', nc$contbr_city)
nc$contbr_city <- gsub('HILLSB.*', 'HILLSBOROUGH', nc$contbr_city)
nc$contbr_city <- gsub('HOPE MILLS,', 'HOPE MILLS', nc$contbr_city)
nc$contbr_city <- gsub('HUNTER.*', 'HUNTERSVILLE', nc$contbr_city)
nc$contbr_city <- gsub('JACKSONVILLE,', 'JACKSONVILLE', nc$contbr_city)
nc$contbr_city <- gsub('KERNERVILLE, NC', 'KERNERVILLE', nc$contbr_city)
nc$contbr_city <- gsub('KILL DEVIL.*', 'KILL DEVIL HILLS', nc$contbr_city)
nc$contbr_city <- gsub('KINGS.*', 'KINGS MOUNTAIN', nc$contbr_city)
nc$contbr_city <- gsub('LEICESER', 'LEICESTER', nc$contbr_city)
nc$contbr_city <- gsub('MARS.*HILL', 'MARS HILL', nc$contbr_city)
nc$contbr_city <- gsub('MIRRISVILLE', 'MORRISVILLE', nc$contbr_city)
nc$contbr_city <- gsub('MT.*PLEASANT', 'MOUNT PLEASANT', nc$contbr_city)
nc$contbr_city <- gsub('MT.*ULLA', 'MOUNT ULLA', nc$contbr_city)
nc$contbr_city <- gsub('MT.*AIRY', 'MOUNT AIRY', nc$contbr_city)
nc$contbr_city <- gsub('MT.*GILEAD', 'MOUNT GILEAD', nc$contbr_city)
nc$contbr_city <- gsub('NEW.*BERN', 'NEW BERN', nc$contbr_city)
nc$contbr_city <- gsub('NORTH TOPSAIL.*', 'NORTH TOPSAIL BEACH', nc$contbr_city)
nc$contbr_city <- gsub('OCEAN ISL BCH', 'OCEAN ISLE BEACH', nc$contbr_city)
nc$contbr_city <- gsub('PILOT.*', 'PILOT MOUNTAIN', nc$contbr_city)
nc$contbr_city <- gsub('PITTSBORRO', 'PITTSBORO', nc$contbr_city)
nc$contbr_city <- gsub('RA.*LEI.*', 'RALEIGH', nc$contbr_city)
nc$contbr_city <- gsub('RALIEGH', 'RALEIGH', nc$contbr_city)
nc$contbr_city <- gsub('REIDSVILLE.*', 'REIDSVILLE', nc$contbr_city)
nc$contbr_city <- gsub('ROANOKE RAPID.*', 'ROANOKE RAPIDS', nc$contbr_city)
nc$contbr_city <- gsub('ROCKY M.*', 'ROCKY MOUNT', nc$contbr_city)
nc$contbr_city <- gsub('SCALY MTN', 'SCALY MOUNTAIN', nc$contbr_city)
nc$contbr_city <- gsub('SOUTH.*P.*NES', 'SOUTHERN PINES', nc$contbr_city)
nc$contbr_city <- gsub('WAK.*FOREST', 'WAKE FOREST', nc$contbr_city)
nc$contbr_city <- gsub('WIL.*MINGTON', 'WILMINGTON', nc$contbr_city)
nc$contbr_city <- gsub('WIMGATE', 'WINGATE', nc$contbr_city)
nc$contbr_city <- as.factor(nc$contbr_city)
```

# Univariate Plots Section

```{r echo=FALSE, Univariate_Plots}

# basic info --------------------------------------------
dim(nc)
names(nc)
str(nc)
levels(nc$cand_nm)
# levels(nc$contbr_city)
summary(subset(nc, contb_receipt_amt > 0))

ggplot(data = subset(nc, contb_receipt_amt > 0), aes(contb_receipt_amt)) + 
  geom_histogram(binwidth = 25) + 
  coord_cartesian(xlim = c(0, 5000)) 

ggplot(data = subset(nc, contb_receipt_amt > 0), aes(contb_receipt_amt)) + 
  geom_histogram(binwidth = 20) + 
  coord_cartesian(xlim = c(0, 500))

ggplot(data = subset(nc, contb_receipt_amt > 0 & 
                       cand_nm == 'Obama, Barack'),
       aes(contb_receipt_amt)) +
  geom_histogram(binwidth = 20) + ggtitle('Obama') +
  coord_cartesian(xlim = c(0, 500))

ggplot(data = subset(nc, contb_receipt_amt > 0 & 
                       cand_nm == 'Romney, Mitt'),
       aes(contb_receipt_amt)) +
  geom_histogram(binwidth = 20) + 
  ggtitle('Romney') +
  coord_cartesian(xlim = c(0, 500))
```

There is only one contributor above $5000. Since the data is long-tailed, I adjusted the binwidth and x-axis in an attempt to gain a better understanding of the contribution distribution. By reducing the binwidth to address bias, the variance increases, but we can see that contributions are somewhat bimodal around $50 and $100. The huge dropoff between values shows how people generally donate values that are regular numbers ($50, $100, $150, $200, $250). 

For Obama, we can see that most contributions are well under $500 with a mode below $50. The histogram shows a mode under $50. For Romney, the mode is above $100 with a significant amount of individuals donating around $250. 

```{r echo=FALSE}
ggplot(data = subset(nc, contb_receipt_amt > 0), aes( contb_receipt_dt)) + 
  geom_histogram() + 
  scale_x_date(limits = c(as.Date('2011-07-25'), '2013-01-01'))

count(subset(nc, contb_receipt_amt > 0), contb_receipt_dt) %>% arrange(desc(n))
```

The data is unimodal around October 2012, which was the peak of election season right before Election Day in November. Since the receipt date officially reflects the date the contribution is relinquished from the contributor, the peak in October makes sense; campaigns would certainly utilize the most money around that time of year for the final push.

``` {r echo=FALSE}
summary(nc$cand_nm)

count(nc, contb_receipt_amt <= 0)

sum(nc$contb_receipt_amt[which(nc$party == 'Democratic' &                              nc$contb_receipt_amt > 0)])

sum(nc$contb_receipt_amt[which(nc$party == 'Republican' &                             nc$contb_receipt_amt > 0)])

summary(nc$contb_receipt_amt[which(nc$cand_nm == 'Obama, Barack' & nc$contb_receipt_amt > 0)])

summary(nc$contb_receipt_amt[which(nc$party == 'Republican' & nc$contb_receipt_amt > 0)])
```

There exist a good amount of contributors with receipt amounts of either 0 or negative values (1236). These exist to show contribution checks that were bounced or returned. For the sake of calculations, these rows will be excluded. 
Most campaign contributors in North Carolina gave to Barack Obama (106,847) with Mitt Romney at a distant second (40,665). However, the total amount donated to the Democratic ($10,607,642) is significantly less than that of Republicans ($16,048,404). Doing some simple mathematics, Democrats donated about $99.28 each on average while Republicans averaged about $329.84 per contributor. However, median contribution might be a better measure of central tendency because of the sheer amount of outliers. That being said, Democrats had a median contribution of $40 while Republicans had a median contribution of $100. 

``` {r echo=FALSE}
summary(nc$contbr_zip)
triangle <- sum(nc$contb_receipt_amt[which((nc$contbr_city == 'CARY' | nc$contbr_city == 'DURHAM' | nc$contbr_city == 'RALEIGH' | nc$contbr_city == 'CHAPEL HILL') & nc$contb_receipt_amt > 0)])

triangle / sum(nc$contb_receipt_amt[which(
  nc$contb_receipt_amt > 0)])

charlotte <- sum(nc$contb_receipt_amt[which(  nc$contbr_city == 'CHARLOTTE' & nc$contb_receipt_amt > 0)])

charlotte / sum(nc$contb_receipt_amt[which( nc$contb_receipt_amt > 0)])

charlottemet <- sum(nc$contb_receipt_amt[which((         nc$contbr_city == 'CHARLOTTE' |                         nc$contbr_city == 'CONCORD' |                            nc$contbr_city == 'GASTONIA' |                           nc$contbr_city == 'ROCK HILL' |                          nc$contbr_city == 'HUNTERSVILLE' |                       nc$contbr_city == 'KANNAPOLIS' |                         nc$contbr_city == 'HICKORY' |                           nc$contbr_city == 'INDIAN TRAIL' |                       nc$contbr_city == 'MOORESVILLE' |                        nc$contbr_city == 'MONROE') &                            nc$contb_receipt_amt > 0)])

charlottemet / sum(nc$contb_receipt_amt[which(nc$contb_receipt_amt > 0)])
```

The top five zipcodes for contributors are all from the Triangle area, specifically Durham and Chapel Hill. The total contribution from the Triangle area (Durham, Chapel Hill, Raleigh, and Cary) amounts to $7,239,282.72, which is 27.15% of the total contribution by the state. Charlotte, the most populous city in NC, contributed $3,978,937.01, or about 14.92% of the total contribution. 
Even if the 10 largest cities comprising of the Charlotte Metropolitan area are included, the contribution ($4,643,388.72, 18.32%) still pales in comparison to the Triangle. The concentration of the state's top universities (NC State, UNC Chapel Hill, and Duke) in the Triangle area might contribute to the difference.

```{r echo=FALSE}
ggplot(data = subset(nc, cand_nm == 'Obama, Barack' | cand_nm == 'Romney, Mitt'), aes(cand_nm)) + 
  geom_bar()

ggplot(data = subset(nc, party == 'Democratic' | party == 'Republican'), aes(party)) + 
  geom_bar()
```

These are just a few bar graphs to show the distribution of candidates and parties from contributions. Again, the Democratic party and Obama garnered the most amount of contributions.


# Univariate Analysis

### What is the structure of your dataset?
Through the FEC website, I chose to examine the state of North Carolina and its financial contributions during the 2012 presidential campaign (Republicans eventually took the state with 50.39% over Democrats' 48.35%). There were 156,828 contributors with 19 (18 plus one I created) features. None of the variables are ordered factor variables; they are either categorical or quantitative.  

The plurality of contributors are retired, self-employed, or unemployed. Campaign contributions are capped at $2,700 per election to a Federal candidate. However, individuals can give up to $5,000 to Political Action Committees (PACs) or up to $10,000 to the State or local party committee.

### What is/are the main feature(s) of interest in your dataset?
The main features in this data set are contribution amount and candidate/party affiliation. I would like to examine which variables determine the amount of contribution towards a specific candidate or political party. This is probably some combination of geographic region (zipcode, city) and the candidate or party him/herself. 

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
It would be interesting to look at the occupations and employers of contributors who are in the workforce. Perhaps this could also provide some insight as to what type of companies support each candidate. Even though Republican donors gave fewer contributions, the amount contributed was far greater than their Democratic counterparts. Subsetting the data by party will allow for more exploration into this discrepancy.

### Did you create any new variables from existing variables in the dataset?
A new column called party was created to represent each candidate's political party. A majority were Republican with the exceptions of Barack Obama (D), Gary Johnson (Libertarian), and Jill Stein (Green). Even though there were 10 Republican candidates, Obama and the Democratic party received the most number of contributions (107631). Republicans outside of Mitt Romney receieved a total of less than 8,000 contributions. The Libertarian (273) and Green (30) parties receieved comparably miniscule amounts.
Another new column called threedigit_zip was created since the first three digits of a zipcode specify a city or divides a larger city into several smaller parts. Sometimes, five-digit zipcodes are too specific, as some cities can have numerous five-digit zipcodes with identical first three digits.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
Barack Obama dominated campaign contributions, but Mitt Romney won the state with 51% of the popular vote, showing a discrepancy between funding and candidate popularity.
There also exist some negative campaign contributions up to -$5,000, which are nonsensical. 
Zipcodes were often in the extended format, so I amended these to only show 5 digits. In addition, many rows had incorrectly spelled city names (Asheville, Ashevile, Ashville), so I corrected these fields with regex. This would give me a more accurate look into which areas of NC generally supported which candidate.
The dates were in a nonstandard format, so I converted them into YYYY-MM-DD format using as.Dates in order to fully utilize this column.

# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots, fig.width = 9}

ggplot(data = subset(nc, contb_receipt_amt > 0 & 
                       (cand_nm == 'Bachmann, Michele' |
                        cand_nm == 'Cain, Herman' |
                        cand_nm == 'Gingrich, Newt' |
                        cand_nm == 'Obama, Barack' |
                        cand_nm == 'Paul, Ron' |
                        cand_nm == 'Perry, Rick' |
                        cand_nm == 'Romney, Mitt' |
                        cand_nm == 'Johnson, Gary Earl' |
                        cand_nm == 'Stein, Jill')), 
       aes(x = cand_nm, 
           y = contb_receipt_amt)) +
  geom_boxplot(outlier.colour = 'green') +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  coord_cartesian(ylim = c(0, 2000))

ggplot(data = subset(nc, contb_receipt_amt > 0 & (party == 'Democratic' | party == 'Republican')), 
       aes(x = party, 
           y = contb_receipt_amt)) +
  geom_boxplot(outlier.colour = 'green') +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  coord_cartesian(ylim = c(0, 1000))
```

The top two candidates, Obama and Romney have an extraordinary amount of outliers.

```{r echo=FALSE}

quantile(nc$contb_receipt_amt[which(nc$cand_nm == 'Obama, Barack' & nc$contb_receipt_amt > 0)])

obamalowerq <- quantile(nc$contb_receipt_amt[which(nc$cand_nm == 'Obama, Barack' & nc$contb_receipt_amt > 0)], 0.25)

obamahigherq <- quantile(nc$contb_receipt_amt[which(nc$cand_nm == 'Obama, Barack' & nc$contb_receipt_amt > 0)], 0.75)

obamaiqr = obamahigherq - obamalowerq

count(subset(nc, 
             cand_nm == 'Obama, Barack'),
      (contb_receipt_amt > 
         (obamaiqr * 1.5) + obamahigherq))

quantile(nc$contb_receipt_amt[which(
  nc$cand_nm == 'Romney, Mitt' & 
    nc$contb_receipt_amt > 0)])

romneylowerq <- quantile(nc$contb_receipt_amt[which(
  nc$cand_nm == 'Romney, Mitt' & 
    nc$contb_receipt_amt > 0)], 
  0.25)

romneyhigherq <- quantile(nc$contb_receipt_amt[which(
  nc$cand_nm == 'Romney, Mitt' & 
    nc$contb_receipt_amt > 0)], 
  0.75)

romneyiqr = romneyhigherq - romneylowerq

count(subset(nc, 
             cand_nm == 'Romney, Mitt'),
      (contb_receipt_amt > 
         (obamaiqr * 1.5) + obamahigherq))

quantile(nc$contb_receipt_amt[which(
  nc$cand_nm == 'Perry, Rick' & 
    nc$contb_receipt_amt > 0)])
```

Obama's contributors averaged around $99.28 with an Interquartile Range of $81 (100 - 19). There are 10,935 outliers out of the total 106,847 Obama contributors, or who donated greater than $221.50 (1.5 * 81 + 100). 

Romney's contributors averaged $100 with an IQR of $200 (250 - 50). There are 15,669 outliers out of the total 40,665 Romney contributors, or who donated greater than $550 (1.5 * 200 + 250). 

Rick Perry contributors had the highest mean contribution of $400 with a 75% quartile of $1,750. It seems that Perry supporters donated in larger chunks than other candidates. 

```{r echo=FALSE}
ggplot(data = subset(nc, contb_receipt_amt > 0), 
       aes(x = contb_receipt_dt, 
           y = contb_receipt_amt)) + 
  geom_point() + 
  scale_x_date(limits = c(as.Date('2011-07-25'),
                          '2013-01-01'))

ggplot(data = subset(nc, contb_receipt_amt > 0), 
       aes(x = contb_receipt_dt, 
           y = contb_receipt_amt)) + 
  geom_line() + 
  scale_x_date(limits = c(as.Date('2011-07-25'),
                          '2013-01-01'))

ggplot(data = subset(nc, contb_receipt_amt > 0 & 
                       (cand_nm == 'Obama, Barack' | 
                          cand_nm == 'Romney, Mitt')), 
       aes(contb_receipt_dt)) + 
  geom_histogram() + 
  scale_x_date(limits = c(as.Date('2011-07-25'),
                          '2013-01-01')) + 
  facet_wrap( ~ cand_nm)
```

As we can see, the date does not predict monetary amount of contribution.  However, faceting by candidate does show that the number of contributions increased for the two relevant candidates, Obama and Romney, up to Election Day (November 6, 2012). For other Republican candidates, the level of contribution rose during their campaigns and fell after they were not selected through the Primary or decided to drop out of the race. Libertarian and Green Party candidates Johnson and Stein did not have nearly the level of financial support that the two main parties possessed.

``` {r echo=FALSE}
ggplot(data = subset(nc, contb_receipt_amt > 0 & 
                       (cand_nm == 'Obama, Barack' | 
                          cand_nm == 'Romney, Mitt')),
       aes(contb_receipt_amt)) + 
  geom_histogram(binwidth = 20) + 
  facet_wrap( ~ cand_nm) + 
  coord_cartesian(xlim = c(0, 500))
```

Faceting by candidate reinforces the fact that the median donation for Obama is less than that of Romney.

``` {r echo=FALSE}
ggplot(data = subset(nc, contb_receipt_amt > 0 & (party == 'Democratic' | party == 'Republican')),
       aes(party, fill = cand_nm)) + 
  geom_bar()

candidate <- group_by(subset(nc, contb_receipt_amt > 0),
                      cand_nm)

nc.total_by_cand <- summarise(candidate,
                  cont_count = n(),
                  cont_total = sum(contb_receipt_amt[which(contb_receipt_amt > 0)]))

nc.total_by_cand <- arrange(nc.total_by_cand, cand_nm)

head(nc.total_by_cand, 13)
```

Obama was campaigning for reelection and was therefore the sole representative for the Democratic Party. Romney eventually edged out the other Republican nominees for the candidacy race, which can be reflected in the chart: his contribution count and total dwarf the rest of the Republicans' numbers.

``` {r echo=FALSE}
date <- group_by(subset(nc, contb_receipt_amt > 0),
                 contb_receipt_dt)

nc.total_by_date <- summarise(date,
    cont_count = n(),
    cont_total = sum(contb_receipt_amt[which(contb_receipt_amt > 0)]))

nc.total_by_date <- arrange(nc.total_by_date,
                            contb_receipt_dt)

head(top_n(nc.total_by_date, 20))
```

Created a new table that gives the total contribution each day for all candidates. However, the time series has uneven spacing, and it would not make sense to use linear interpolation to transform this data. One would have to somehow build a continuous-time stochastic model or try an advanced algorithm specific to irregularly spaced time-series.

``` {r echo=FALSE}
zip <- group_by(subset(nc, contb_receipt_amt > 0),
                contbr_zip)
nc.total_by_zip <- summarise(zip,
    cont_count = n(),
    cont_total = sum(contb_receipt_amt[which(contb_receipt_amt > 0)])) 

nc.total_by_zip <- arrange(nc.total_by_zip,
                           desc(cont_total))

head(nc.total_by_zip, 20)

city <- group_by(subset(nc, contb_receipt_amt > 0),
                 contbr_city)

nc.total_by_city <- summarise(city,
    cont_count = n(),
    cont_total = sum(contb_receipt_amt[which(contb_receipt_amt > 0)]))

nc.total_by_city <- arrange(nc.total_by_city,
                            desc(cont_total))

head(nc.total_by_city, 20)

ggplot(data = subset(nc, contbr_city == 'CHARLOTTE' & (party == 'Democratic' | party == 'Republican')),
       aes(party, fill = cand_nm)) + 
  geom_bar()
```

The zipcodes and cities that contributed the most total contribution were located in Charlotte and the Triangle (Chapel Hill, Durham, and Raleigh). This is to be expected since these two are the largest and most populous areas of North Carolina.

``` {r echo=FALSE}
job <- group_by(subset(nc, contb_receipt_amt > 0),
                contbr_occupation)

nc.total_by_job <- summarise(job,
    cont_count = n(),
    cont_total = sum(contb_receipt_amt[which(contb_receipt_amt > 0)])) 

nc.total_by_job$mean <- nc.total_by_job$cont_total / nc.total_by_job$cont_count

nc.total_by_job <- arrange(nc.total_by_job,
                           desc(cont_total))

head(nc.total_by_job, 20)
```

It is interesting to note that a significant chunk of contributors are retired. Ignoring the significant portion of contributors who declined to state their profession, the next top contributors are homemakers. As homemakers most likely do not generate very much income, it is feasible to attribute this high contribution total to those who match their contribution with that of their spouse (this is an available and widely used option in campaign donations). After homemakers are contributors that come from highly esteemed careers such as physicians, attorneys, professors, executives, and presidents. 

``` {r echo=FALSE}
employer <- group_by(subset(nc, contb_receipt_amt > 0),
                     contbr_employer)

nc.total_by_employer <- summarise(employer,
    cont_count = n(),
    cont_total = sum(contb_receipt_amt[which(contb_receipt_amt > 0)]))

nc.total_by_employer <- arrange(nc.total_by_employer,
                                desc(cont_total))

head(nc.total_by_employer, 20)
```

Retired contributors are still the top contributors, but self-employed contributors are in second. The term itself is vague, but individuals who comprise this group most likely comprised of small business owners(grocers, restaurants, etc.). 

```{r echo=FALSE}
ggplot(data = subset(nc, (contbr_employer == 'SELF-EMPLOYED' | contbr_employer == 'SELF') & (party == 'Democratic' | party == 'Republican')), 
       aes(party, fill = cand_nm)) + 
  geom_bar() + 
  ggtitle('Self-Employed')

ggplot(data = subset(nc, contbr_occupation == 'RETIRED' & (party == 'Democratic' | party == 'Republican')),
       aes(party, fill = cand_nm)) + 
  geom_bar() + 
  ggtitle('Retired')

ggplot(data = subset(nc, contbr_occupation == 'HOMEMAKER' & (party == 'Democratic' | party == 'Republican')), 
       aes(party, fill = cand_nm)) + 
  geom_bar() + 
  ggtitle('Homemaker Count')

nc.total_by_job <- nc.total_by_job[-2,]
nc.total_by_job <- nc.total_by_job[-5,]
ggplot(data = subset(head(nc.total_by_job, 5)), 
       aes(x = contbr_occupation, 
           y = cont_total)) +
  geom_bar(stat = 'identity') + 
  ggtitle('Top Occupations Total Contribution')
```

Subsetting the data to just self-employed individuals reveals a chart that is identically-shaped to the chart with complete data. However, subsetting the data to just retired individuals shows that a proportionally greater amount of retired contributors gave to Romney when compared to all occupations. Obama still dominated the contribution count even amongst retired people, but the proportion of contributions is less. Amongst homemakers, the divide between Democratic and Republican is much more evenly split (~2,400 donations for Democrats and just under 2,000 donations for Republicans). The Top Occupations Total Contribution chart shows how much more Retired contributors give (contribution receipt amount) than any other occupation.

``` {r echo=FALSE, fig.height=10}
tbl_zip <- subset(subset(nc, contb_receipt_amt > 0 & threedigit_zip >= 270 & threedigit_zip < 290 & (party == 'Democratic' | party == 'Republican')), select = c("threedigit_zip", "party"))

tbl_zip <- tbl_zip[order(tbl_zip$threedigit_zip, tbl_zip$party),]

tbl_zip <- tbl_zip %>%
  count(threedigit_zip, party)

tbl_zip <- spread(tbl_zip, party, n)

tbl_zip_test <- tbl_zip[, -1]

chisq.test(tbl_zip_test)

nc_true <- subset(nc, threedigit_zip >= 270 &                     threedigit_zip < 290)

mosaic(nc_true$party ~ nc_true$threedigit_zip)
```

Limited 3 digit zipcodes to between 270 and 289 since all North Carolina zipcodes are within that range.
Using a Chi-squared test, we get a p-value of almost 0. Therefore we strongly reject the null hypothesis that party affiliation is independent of zipcode. 

The mosaic of three digit zipcodes and party represents how for each zipcode, contributors consistently donated more often for Democratics than Republicans. The split was more even in zipcodes corresponding with Kingston (285), Greensboro (270), and Charlotte (281).

``` {r echo=FALSE}
tbl_city = subset(subset(nc, contb_receipt_amt > 0 & threedigit_zip >= 270 & threedigit_zip < 290 & (party == 'Democratic' | party == 'Republican')), select = c("contbr_city", "party"))

tbl_city <- tbl_city %>%
  count(contbr_city, party)

tbl_city <- spread(tbl_city, party, n)

tbl_city[is.na(tbl_city)] <- 0

tbl_city_test <- tbl_city[, -1]

chisq.test(tbl_city_test)
```

Similar procedure done on contributor city and party reveals the same. We reject the null hypothesis that a contributor's city is independent of party affiliation. 

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

As most of the variables are nominal (most are simply labels for each contributor), it was infeasible to try and take the correlation of any two variables. However, despite the lack of correlation, there are several observations to be made.

For the two main candidates: Barack Obama and Mitt Romney, the amount of contributions (contribution receipt amount) stayed mostly constant throughout the election process until the final month before Election Day. Campaigns probably utilize the most money during that time since it resembles a final push and there is no incentive to withhold spending after elections.

Obama contributors gave less than Romney contributors on average despite having a much higher contribution count. Rick Perry contributors gave an overwhelmingly higher average donation, but the total amount paled in comparison to the two main candidates as Perry did not win the nomination and subsequently dropped out of the race.

The cities and zipcodes with the most amount of contributors were located in the top two metropolitan areas of North Carolina, Charlotte and the Triangle (Raleigh, Durham, Chapel Hill). The distribution of contributions in these cities was identical to the that of the total dataset, with Obama garnering the most contributions by far with Romney in second with significantly less.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

Looking at occupations and employers, the distribution of contributions is noticeably different with Retired Individuals and Homeowners. Homeowners are almost evenly split between donating to Obama and to Romney, while Retired individiuals have a slightly higher than usual proportion donated to Romney compared to the grand distribution. Retired contributors gave vastly more total money than any other profession.  

### What was the strongest relationship you found?
Since campaign receipt was the only numerical (discrete) variable, the only way to measure independence between numerical and categorical (nominal) variables was through a Chi-squared Test of Independence. Running one between party affiliation and zipcode showed that the two variables are definitely not independent of each other (p-value close to 0). A similar test between party affiliation and city produced similar results. However, the strength of these relationships are unknown.

Using ANOVA to evaluate grouped means between contribution receipt and nominal variables (party, zipcode, city) would be infeasible in this case since receipts are discrete, not a continuous variable.

# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}
ggplot(data = subset(nc, contb_receipt_amt > 0 &
                       (cand_nm == 'Obama, Barack' |
                          cand_nm == 'Romney, Mitt')), 
       aes(x = contb_receipt_dt, 
           y = contb_receipt_amt, 
           color = cand_nm)) + 
  scale_x_date(limits = c(as.Date('2011-07-25'),
                          '2013-01-01')) +
  stat_summary(fun.y = sum, geom = 'line') 
```

We can see huge spikes of daily contributions in April and the few months leading up to Election Day, especially for Mitt Romney. Maybe looking at cumulative sums would be more interesting than daily sums.

``` {r echo=FALSE}
obama_by_date <- group_by(subset(nc,                                    contb_receipt_amt > 0 &                                  cand_nm == 'Obama, Barack'),                   contb_receipt_dt)

obama_by_date <- obama_by_date[order(obama_by_date$contb_receipt_dt),]

obama_by_date <- obama_by_date[,                              c("contb_receipt_dt", "contb_receipt_amt")]

obama_by_date_sum <- aggregate(.~contb_receipt_dt,                              data = obama_by_date,                               sum)

obama_by_date_sum$contb_receipt_cumsum <- cumsum(obama_by_date_sum$contb_receipt_amt)

romney_by_date <- group_by(subset(nc,                                  contb_receipt_amt > 0 &                                 cand_nm == 'Romney, Mitt'),                              contb_receipt_dt)

romney_by_date <- romney_by_date[order(romney_by_date$contb_receipt_dt),]

romney_by_date <- romney_by_date[,                             c("contb_receipt_dt", "contb_receipt_amt")]

romney_by_date_sum <- aggregate(.~contb_receipt_dt,                                data = romney_by_date,                               sum)

romney_by_date_sum$contb_receipt_cumsum <- cumsum(romney_by_date_sum$contb_receipt_amt)

ggplot() + 
  geom_line(data = romney_by_date_sum, 
            aes(x = contb_receipt_dt,
                y = contb_receipt_cumsum), 
                color = 'blue') + 
  geom_line(data = obama_by_date_sum, 
            aes(x = contb_receipt_dt, 
                y = contb_receipt_cumsum), 
                color = 'red') + 
  annotate("text", 
           x = as.Date('2012-11-01', '%Y-%m-%d'), 
           y = 5.0e+06, 
           label = 'Obama, Barack') + 
  annotate("text",
           x = as.Date('2012-10-01', '%Y-%m-%d'),
           y = 1.25e+07,
           label = 'Romney, Mitt')
```

Looking at cumulative sums, we can see that Obama begins the campaign with a higher sum, but is overtaken by Romney around April 2012. Romney came to Charlotte, North Carolina on April 18, 2012 to give a speech, so this could be the cause of the giant spike of contributions in that month.

``` {r echo=FALSE, fig.width = 10}
total_by_zip <- group_by(subset(nc_true,
                                contb_receipt_amt > 0),
                         threedigit_zip)
total_by_zip <- total_by_zip[order(total_by_zip$threedigit_zip),]

total_by_zip <- aggregate(cbind(contb_receipt_amt)~threedigit_zip+cand_nm, 
                          data = total_by_zip, 
                          sum, 
                          na.rm = TRUE)

ggplot(data = subset(total_by_zip, 
                     cand_nm == 'Obama, Barack' |
                       cand_nm == 'Romney, Mitt'), 
       aes(x = threedigit_zip, 
           y = contb_receipt_amt)) + 
  geom_bar(stat = 'identity') + 
  facet_wrap( ~ cand_nm)

ggplot(data = subset(total_by_zip, 
                     (cand_nm == 'Bachmann, Michele' |
                        cand_nm == 'Cain, Herman' |
                        cand_nm == 'Gingrich, Newt' |
                        cand_nm == 'Paul, Ron' | 
                        cand_nm == 'Perry, Rick' |
                        cand_nm == 'Johnson, Gary Earl')), 
       aes(x = threedigit_zip,
           y = contb_receipt_amt)) + 
  geom_bar(stat = 'identity') + 
  facet_wrap( ~ cand_nm, ncol = 2)
```

Between Obama and Romney, we can see that the Obama receieved the most donations from the Raleigh area (three-digit code 275 and 276) while Romney received his most donations from Charlotte (280-282). Obama receieved the second most donations from Durham while Romney received one of the smallest amounts by zipcode from Durham (Durham is a much more liberal county than the rest of the state). 

On a smaller scale between the other relevant Republican nominees and libertarian candidate Gary Earl Johnson, Ron Paul led this smaller group with major donations from Raleigh, Charlotte, and Asheville. Rick Perry relied on donations solely from Charlotte. The amount of financial support for third party candidates such as Gary Johnson is similar to that of low-popularity Republican nominees who dropped out of the race early. 

``` {r echo=FALSE}
nc_true <- subset(nc_true, contb_receipt_amt > 0)

ggplot(data = nc_true[order(nc_true$party),], 
       aes(x = threedigit_zip, 
           y = contb_receipt_amt, 
           color = party)) + 
  geom_bar(stat = 'identity')
```

This bar chart reflects how Obama received more from the Raleigh area and Romney received more from the Charlotte Area. However, the discrepancy between the two candidates in Charlotte is huge: the contributions towards Romney versus Obama is almost a 3:1 ratio. The Durham area also exhibits a large ratio skewed towards Obama with what almost looks like a 5:1 ratio. 

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?
Obama received a higher amount of total contribution amount towards the beginning of the campaign, but the efforts of Romney in the final year, including giving a speech in Charlotte, strengthened his run in the final stretch and caused him to pull ahead in terms of financial support. We could already say for certainty through previous chi-square tests that party is not independent of zipcode and city, and these plots furthered strengthened that claim. 

### Were there any interesting or surprising interactions between features?

It was surprising to see how much discrepancy there was between the two main candidates in larger cities. North Carolina has been a swing state in recent years, voting Democratic in 2008 but Republican in 2012. The level of contribution to the two parties in 2012 shows public sentiment shifting towards Romney, whether it be through his extra efforts in the state or Obama's current term in the office preventing his campaign from reaching the same level of notoriety as in 2008. In 2012, contributors from large cities showed more favor towards Romney as compared to before, even if Raleigh as a whole donated more towards Obama. In smaller zipcodes (with the exception of Durham), the amount of support for Romney overwhelmed that of Obama, probably because small towns in North Carolina largely vote conservative.

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

As stated before, the only possible model would be a time-series model between receipt date and receipt amount. However, the date times are unevenly split, which makes modeling this data very difficult without an advanced algorithm.


------


# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
ggplot(data = subset(nc, contb_receipt_amt > 0),
       aes(contb_receipt_amt)) + 
  geom_histogram(binwidth = 20, 
                 fill = "darkgreen") +
  coord_cartesian(xlim = c(0, 500)) +
  ggtitle('Contribution Receipt Amount') +
  xlab('Contribution Receipt Amount (dollars)') +
  ylab('Number of Receipts')

```

### Description One

Contributions are somewhat bimodal around $50 and $100. Above $50, there are huge dropoffs between $50 increments, which shows how people generally donate values that are regular numbers ($50, $100, $150, $200, $250). 

### Plot Two
```{r echo=FALSE, Plot_Two}
ggplot() + 
  geom_line(data = romney_by_date_sum, 
            aes(x = contb_receipt_dt, 
                y = contb_receipt_cumsum), 
                color = 'blue') + 
  geom_line(data = obama_by_date_sum, 
            aes(x = contb_receipt_dt, 
                y = contb_receipt_cumsum), 
                color = 'red') + 
  annotate("text",
           x = as.Date('2012-11-01', '%Y-%m-%d'),
           y = 5.0e+06, 
           label = 'Obama, Barack') + 
  annotate("text", 
           x = as.Date('2012-10-01', '%Y-%m-%d'), 
           y = 1.25e+07,
           label = 'Romney, Mitt') +
  ggtitle('Cumulative Contribution Total from 2011 to 2013') + 
  xlab('Date') + 
  ylab('Cumulative Contribution Amount (dollars)')
```

### Description Two

From 2011 to 2013, where the bulk of contribution donations occurred, Obama held a slight lead in the earlier months until around April 2014, when Romney campaigned within North Carolina, giving a speech in Charlotte and driving a large boost of contributions. By Election Day, Romney and the Republicans had amassed a much larger cumulative total over the Democrats, and the Republicans won the popular vote in North Carolina.

### Plot Three
```{r echo=FALSE, Plot_Three}
ggplot(data = nc_true[order(nc_true$party),],
       aes(x = threedigit_zip,
           y = contb_receipt_amt, 
           color = party)) + 
  geom_bar(stat = 'identity') + 
  ggtitle('Contribution Receipt Totals by Zipcode') +
  xlab('Three Digit Zipcodes') +
  ylab('Contribution Receipt Total (dollars)')
```

### Description Three

This bar chart reflects how Democrats (Obama) received more from the Raleigh area and the Republicans (mostly Romney) received more from the Charlotte Area. However, the discrepancy between the two candidates in Charlotte is huge: the contributions towards Republicans versus Obama is almost a 3:1 ratio. The Durham area also exhibits a large ratio skewed towards the other direction with what almost looks like a 5:1 Obama to Republican ratio. 

------

# Reflection

The nc data set contained contribution information on almost 160,000 individuals from the 2012 Presidential Election. Although the variables were mostly categorical (nominal) with the exception of contribution receipt amount and date, there was still much examination to be done regarding donation splits among candidates and parties. Eventually, I explored the amount of financial contribution across several variables and was able to visualize the distribution of contribution receipts over several variables such as party, zipcode, city, and occupation. Unfortunately, this data could not be modeled due to the uneven dates; linear interpolation to fill in between dates would not be a feasible solution. However, through manipulating the data and grouping the data by different variables, I was able to discover just how much more funding and support Mitt Romney and the Republicans had than Obama and the Democrats. In addition, I examined the split of donations across zipcodes and cities of North Carolina and its inhabitants' occupations to gain a better picture of how the state contributed to each party as a whole and in parts. In the future, for better and more in-depth analyses, it would be interesting to explore additional occupational metrics such as annual salary to see if there existed a relationship between annual salary and contribution amount. Another idea would be to examine each county's voting distribution to see if voting habits and contributions are similar in a given county. Finally, additional information about contributors themselves such as their age, gender, and population of their listed zipcode or city could illuminate trends in these variables and contribution amounts to better predict which sorts of individuals contribute how much and to which party or candidate.
